_G.AstralOrbitEnabled = _G.AstralOrbitEnabled or false
local orbitConnection = nil

if not _G.AstralOrbitEnabled then
    _G.AstralOrbitEnabled = true
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Smooth Orbit",
        Text = "✅ Focus enabled",
        Duration = 3
    })
    
    local Players = game:GetService("Players")
    local RunService = game:GetService("RunService")
    local LocalPlayer = Players.LocalPlayer
    local Camera = workspace.CurrentCamera
    
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = character:WaitForChild("HumanoidRootPart")
    
    LocalPlayer.CharacterAdded:Connect(function(newChar)
        character = newChar
        hrp = newChar:WaitForChild("HumanoidRootPart")
    end)
    
    local ORBIT_RADIUS = 8
    local ORBIT_HEIGHT = 4
    local ORBIT_SPEED = 0.5
    local orbitAngle = 0
    
    local function getClosestEnemy()
        local closest = nil
        local shortestDist = math.huge
        
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character then
                local enemyHrp = player.Character:FindFirstChild("HumanoidRootPart")
                local humanoid = player.Character:FindFirstChild("Humanoid")
                
                if enemyHrp and humanoid and humanoid.Health > 0 then
                    local dist = (hrp.Position - enemyHrp.Position).Magnitude
                    if dist < shortestDist then
                        shortestDist = dist
                        closest = enemyHrp
                    end
                end
            end
        end
        
        return closest
    end
    
    orbitConnection = RunService.RenderStepped:Connect(function(dt)
        if not _G.AstralOrbitEnabled then return end
        
        local enemyHrp = getClosestEnemy()
        if enemyHrp then
            orbitAngle = orbitAngle + (ORBIT_SPEED * dt)
            local x = math.cos(orbitAngle) * ORBIT_RADIUS
            local z = math.sin(orbitAngle) * ORBIT_RADIUS
            local orbitPos = enemyHrp.Position + Vector3.new(x, ORBIT_HEIGHT, z)
            Camera.CFrame = CFrame.new(orbitPos, enemyHrp.Position)
        end
    end)
    
else
    _G.AstralOrbitEnabled = false
    
    if orbitConnection then
        orbitConnection:Disconnect()
        orbitConnection = nil
    end
    
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Smooth Orbit", 
        Text = "❌ Focus disabled",
        Duration = 2
    })
end
